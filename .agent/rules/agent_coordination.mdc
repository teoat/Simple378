---
description: Mandatory Agent Coordination Rules
globs: *
alwaysApply: true
---
# Agent Coordination Rules

## Context
This project enforces strict agent coordination to prevent conflicts and ensure efficient collaboration between multiple AI agents. All IDE agents MUST use the `agent-coordination` MCP server.

## Mandatory Workflow

### 1. Register Before Starting Work
Before performing any tasks, you must register your session.

```typescript
await mcp.agent_register({
  agentId: "cursor-session-<UUID>",
  capabilities: ["typescript", "rust", "testing", "documentation"]
});
```

### 2. Claim Tasks
You must claim a task before working on it. This signals your intent to other agents.

```typescript
await mcp.agent_claim_task({
  taskId: "task-<ID>",
  agentId: "cursor-session-<UUID>",
  files: ["path/to/file1.ts", "path/to/file2.rs"]
});
```

### 3. Lock Files
Before editing any file, you MUST acquire a lock.

```typescript
await mcp.agent_lock_file({
  file: "path/to/file.ts",
  agentId: "cursor-session-<UUID>",
  reason: "Implementing feature X"
});
```

### 4. Check for Conflicts
Always check for conflicts before starting work to avoid stepping on other agents' toes.

```typescript
const conflicts = await mcp.agent_detect_conflicts({
  agentId: "cursor-session-<UUID>",
  files: ["path/to/file.ts"]
});

if (conflicts.length > 0) {
  // Handle conflicts (e.g., wait or contact user)
}
```

### 5. Update Status
Regularly update your status so other agents know what you are doing.

```typescript
await mcp.agent_update_status({
  agentId: "cursor-session-<UUID>",
  status: "working",
  progress: 50 // Percentage
});
```

### 6. Clean Up
When finished, release resources.

```typescript
// Unlock files
await mcp.agent_unlock_file({ file: "path/to/file.ts", agentId: "cursor-session-<UUID>" });

// Release task
await mcp.agent_release_task({ taskId: "task-<ID>", agentId: "cursor-session-<UUID>" });

// Update status
await mcp.agent_update_status({ agentId: "cursor-session-<UUID>", status: "completed" });
```

## Prohibited Actions
- **Direct File Edits without Locking**: Never edit a file without first locking it via the MCP server.
- **Ignoring Conflicts**: If `agent_detect_conflicts` returns issues, do NOT proceed until resolved.
- **Silent Failure**: Always report errors to the user if coordination fails.

## Error Handling
If the MCP server is unavailable or returns an error:
1. Notify the user immediately.
2. Do not proceed with file modifications.
3. Suggest checking the `agent-coordination` server status.
