# Proposed Architecture Additions

## 1. Human Adjudication System
**Goal:** Provide a workflow for human analysts to review, approve, or reject fraud alerts generated by the system.

### Architecture
- **Database:**
    - `AdjudicationQueue` table: Links `AnalysisResult` to a `User` (analyst).
    - `AdjudicationDecision` table: Records the decision (`ConfirmedFraud`, `FalsePositive`, `Escalated`), comments, and timestamp.
- **API:**
    - `GET /api/v1/adjudication/queue`: List pending alerts.
    - `POST /api/v1/adjudication/{alert_id}/decide`: Submit a decision.
- **Workflow:**
    1.  System generates `AnalysisResult` with high score.
    2.  Alert is added to `AdjudicationQueue`.
    3.  Analyst reviews evidence in UI.
    4.  Analyst submits decision.
    5.  System updates `Subject` risk score based on decision.

## 2. Enhanced CSV Ingestion
**Goal:** Robust ingestion of transaction logs from various CSV formats.

### Architecture
- **Flexible Schema:**
    - Use a `MappingConfig` to map CSV columns (e.g., "Date", "Amount", "Beneficiary") to internal `Transaction` model fields.
- **Validation:**
    - Pydantic models to validate rows during streaming ingestion.
    - Error reporting for malformed rows (store in `IngestionErrors` table).
- **Async Processing:**
    - Large CSVs should be processed in background tasks (Celery or FastAPI BackgroundTasks) to avoid blocking the API.

### 2.1 Multi-Bank Statement Ingestion
**Goal:** Unified processing of statements from different financial institutions (e.g., Chase, Wells Fargo, Local Credit Unions).

- **Data Normalization:**
    - **Unified Transaction Model:** Map diverse CSV headers (e.g., "Posting Date" vs "Date", "Debit" vs "Amount") to a single `Transaction` schema.
    - **Source Tracking:** Add `source_bank` and `source_file_id` to trace data provenance.
- **Entity Resolution:**
    - Identify if "John Doe" at Bank A is the same entity as "J. Doe" at Bank B using fuzzy matching on name + DOB/SSN (if available).
- **Cross-Bank Analysis:**
    - **Mirroring Detection:** Link transfers between accounts at different banks owned by the same subject.
    - **Aggregated Velocity:** Calculate velocity risk across ALL known accounts, not just per-bank.

## 3. Re-verification of Phase 1
**Goal:** Ensure the foundation is solid before building core features.
- **Check:**
    - Docker services health.
    - Database connection and migration status.
    - Auth token generation and validation.

## 4. Notification Service
**Goal:** Real-time alerts for high-priority fraud and system events.
- **Channels:**
    - **In-App:** Server-Sent Events (SSE) or WebSockets for instant dashboard updates.
    - **Email:** SMTP integration for critical alerts (e.g., "High Risk Subject Detected").
    - **Webhook:** Integration with Slack/Teams for ops teams.
- **Architecture:**
    - `NotificationService` in backend.
    - `notifications` table to store history.

## 5. API Gateway (Production Readiness)
**Goal:** Secure entry point for the application.
- **Component:** Nginx or Traefik container.
- **Responsibilities:**
    - **SSL Termination:** Handle HTTPS.
    - **Rate Limiting:** Prevent abuse.
    - **Routing:** Route `/api/*` to Backend and `/*` to Frontend.
    - **Security Headers:** HSTS, CSP, X-Frame-Options.