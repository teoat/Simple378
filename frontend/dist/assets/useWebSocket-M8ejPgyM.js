import{a as e}from"./react-vendor-BuVNz1jA.js";import{u as h}from"./index-BlWFTSEC.js";function E(u,g={}){const{isAuthenticated:a}=h(),[m,f]=e.useState(!1),[k,p]=e.useState(null),n=e.useRef(null),c=e.useRef(0),{onMessage:r,reconnectAttempts:l=5,reconnectInterval:i=3e3}=g,S=e.useRef(()=>{}),s=e.useCallback(()=>{const o=localStorage.getItem("auth_token");if(!(!a||!o))try{const t=new WebSocket(u);t.onopen=()=>{f(!0),c.current=0},t.onclose=()=>{f(!1),c.current<l&&(c.current+=1,setTimeout(()=>S.current(),i))},t.onerror=()=>{},t.onmessage=b=>{try{const d=JSON.parse(b.data);p(d),r&&r(d)}catch{}},n.current=t}catch{}},[u,a,r,l,i]);e.useEffect(()=>{S.current=s},[s]),e.useEffect(()=>(s(),()=>{n.current&&n.current.close()}),[s]);const R=e.useCallback((o,t)=>{n.current&&n.current.readyState===WebSocket.OPEN&&n.current.send(JSON.stringify({type:o,payload:t}))},[]);return{isConnected:m,lastMessage:k,sendMessage:R}}export{E as u};
